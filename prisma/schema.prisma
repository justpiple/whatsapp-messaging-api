generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../database.db"
}

model WhatsappAccount {
  id          Int                   @id @default(autoincrement())
  phoneNumber String                @map("phone_number")
  status      WhatsappAccountStatus @default(INACTIVE)
  createdAt   DateTime              @default(now()) @map("created_at")
  updatedAt   DateTime              @updatedAt @map("updated_at")

  Session             Session[]
  RecipientAccountMap RecipientAccountMap[]

  @@map("whatsapp_accounts")
}

model Session {
  id         Int    @id @default(autoincrement())
  identifier String
  data       String

  WhatsappAccount   WhatsappAccount @relation(fields: [whatsappAccountId], references: [id], onDelete: Cascade)
  whatsappAccountId Int             @map("whatsapp_account_id")

  @@unique([whatsappAccountId, identifier])
  @@index([whatsappAccountId])
  @@map("session")
}

model RecipientAccountMap {
  id                Int      @id @default(autoincrement())
  recipientNumber   String   @map("recipient_number")
  whatsappAccountId Int      @map("whatsapp_account_id")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  whatsappAccount WhatsappAccount @relation(fields: [whatsappAccountId], references: [id], onDelete: Cascade)

  @@unique([recipientNumber])
  @@index([whatsappAccountId])
  @@map("recipient_account_map")
}

model ApiKey {
  id        Int        @id @default(autoincrement())
  name      String
  apiKey    String     @unique @map("api_key")
  role      ApiKeyRole @default(SYSTEM)
  createdAt DateTime   @default(now()) @map("created_at")
  deletedAt DateTime?  @map("deleted_at")

  @@map("api_keys")
}

enum ApiKeyRole {
  ADMIN
  SYSTEM
}

enum WhatsappAccountStatus {
  ACTIVE
  INACTIVE
}
